digraph KaryaKlik_ERD {
    // Graph settings
    graph [
        rankdir=TB,
        splines=ortho,
        nodesep=0.8,
        ranksep=1.2,
        bgcolor="#1a1a2e",
        fontname="Arial",
        pad=0.5
    ];
    
    node [
        shape=record,
        style="filled,rounded",
        fillcolor="#16213e",
        fontcolor="white",
        fontname="Arial",
        fontsize=10,
        color="#0f3460",
        penwidth=2
    ];
    
    edge [
        color="#e94560",
        fontcolor="white",
        fontname="Arial",
        fontsize=9,
        penwidth=2
    ];

    // ============================================
    // TABLES
    // ============================================

    // 1. Users Table
    users [
        fillcolor="#c62828",
        label="{<table> USERS|
            <pk>user_id : VARCHAR (PK)\l|
            name : VARCHAR(50)\l|
            email : VARCHAR(100) UNIQUE\l|
            password : VARCHAR(255)\l|
            role : ENUM('user','admin')\l|
            profile_picture : VARCHAR(255)\l|
            phone_number : VARCHAR(20)\l|
            is_verified : BOOLEAN\l|
            is_active : BOOLEAN\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l|
            last_login : TIMESTAMP\l
        }"
    ];

    // 2. Templates Table
    templates [
        fillcolor="#1565c0",
        label="{<table> TEMPLATES|
            <pk>template_id : VARCHAR (PK)\l|
            name : VARCHAR(100)\l|
            category : VARCHAR(50)\l|
            description : TEXT\l|
            thumbnail_url : VARCHAR(255)\l|
            frame_url : VARCHAR(255)\l|
            frame_count : INT\l|
            width : INT\l|
            height : INT\l|
            is_premium : BOOLEAN\l|
            is_active : BOOLEAN\l|
            <fk1>created_by : VARCHAR (FK)\l|
            views_count : INT\l|
            usage_count : INT\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l
        }"
    ];

    // 3. Template Positions Table
    template_positions [
        fillcolor="#2e7d32",
        label="{<table> TEMPLATE_POSITIONS|
            <pk>position_id : VARCHAR (PK)\l|
            <fk1>template_id : VARCHAR (FK)\l|
            photo_index : INT\l|
            x_coordinate : INT\l|
            y_coordinate : INT\l|
            width : INT\l|
            height : INT\l|
            rotation : DECIMAL\l|
            border_radius : INT\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l
        }"
    ];

    // 4. Photo Sessions Table
    photo_sessions [
        fillcolor="#f57c00",
        label="{<table> PHOTO_SESSIONS|
            <pk>session_id : VARCHAR (PK)\l|
            <fk1>user_id : VARCHAR (FK)\l|
            <fk2>template_id : VARCHAR (FK)\l|
            session_code : VARCHAR(10) UNIQUE\l|
            device_info : TEXT\l|
            ip_address : VARCHAR(50)\l|
            status : ENUM\l|
            total_photos_taken : INT\l|
            started_at : TIMESTAMP\l|
            completed_at : TIMESTAMP\l|
            created_at : TIMESTAMP\l
        }"
    ];

    // 5. Captured Photos Table
    captured_photos [
        fillcolor="#7b1fa2",
        label="{<table> CAPTURED_PHOTOS|
            <pk>photo_id : VARCHAR (PK)\l|
            <fk1>session_id : VARCHAR (FK)\l|
            photo_index : INT\l|
            photo_url : VARCHAR(255)\l|
            file_size : INT\l|
            width : INT\l|
            height : INT\l|
            filter_applied : VARCHAR(50)\l|
            captured_at : TIMESTAMP\l|
            created_at : TIMESTAMP\l
        }"
    ];

    // 6. Final Composites Table
    final_composites [
        fillcolor="#c2185b",
        label="{<table> FINAL_COMPOSITES|
            <pk>composite_id : VARCHAR (PK)\l|
            <fk1>session_id : VARCHAR (FK)\l|
            <fk2>user_id : VARCHAR (FK)\l|
            <fk3>template_id : VARCHAR (FK)\l|
            composite_url : VARCHAR(255)\l|
            file_size : INT\l|
            width : INT\l|
            height : INT\l|
            download_count : INT\l|
            share_count : INT\l|
            qr_code_url : VARCHAR(255)\l|
            share_link : VARCHAR(255)\l|
            is_public : BOOLEAN\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l
        }"
    ];

    // 7. Categories Table
    categories [
        fillcolor="#00796b",
        label="{<table> CATEGORIES|
            <pk>category_id : VARCHAR (PK)\l|
            name : VARCHAR(50)\l|
            slug : VARCHAR(50) UNIQUE\l|
            description : TEXT\l|
            icon : VARCHAR(100)\l|
            color_code : VARCHAR(7)\l|
            display_order : INT\l|
            is_active : BOOLEAN\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l
        }"
    ];

    // 8. User Galleries Table
    user_galleries [
        fillcolor="#5e35b1",
        label="{<table> USER_GALLERIES|
            <pk>gallery_id : VARCHAR (PK)\l|
            <fk1>user_id : VARCHAR (FK)\l|
            <fk2>composite_id : VARCHAR (FK)\l|
            title : VARCHAR(100)\l|
            description : TEXT\l|
            is_favorite : BOOLEAN\l|
            tags : TEXT\l|
            added_at : TIMESTAMP\l|
            created_at : TIMESTAMP\l
        }"
    ];

    // 9. Analytics Events Table
    analytics_events [
        fillcolor="#455a64",
        label="{<table> ANALYTICS_EVENTS|
            <pk>event_id : VARCHAR (PK)\l|
            <fk1>user_id : VARCHAR (FK)\l|
            <fk2>session_id : VARCHAR (FK)\l|
            event_type : VARCHAR(50)\l|
            event_category : VARCHAR(50)\l|
            <fk3>template_id : VARCHAR (FK)\l|
            metadata : TEXT\l|
            device_info : TEXT\l|
            ip_address : VARCHAR(50)\l|
            referrer : VARCHAR(255)\l|
            timestamp : TIMESTAMP\l|
            created_at : TIMESTAMP\l
        }"
    ];

    // 10. System Settings Table
    system_settings [
        fillcolor="#6d4c41",
        label="{<table> SYSTEM_SETTINGS|
            <pk>setting_id : VARCHAR (PK)\l|
            setting_key : VARCHAR(100) UNIQUE\l|
            setting_value : TEXT\l|
            setting_type : VARCHAR(20)\l|
            category : VARCHAR(50)\l|
            description : TEXT\l|
            is_public : BOOLEAN\l|
            <fk1>updated_by : VARCHAR (FK)\l|
            created_at : TIMESTAMP\l|
            updated_at : TIMESTAMP\l
        }"
    ];

    // ============================================
    // RELATIONSHIPS
    // ============================================

    // Users -> Templates (1:N) - Admin creates templates
    users:pk -> templates:fk1 [
        label="creates",
        headlabel="1",
        taillabel="N"
    ];

    // Templates -> Template Positions (1:N)
    templates:pk -> template_positions:fk1 [
        label="has",
        headlabel="1",
        taillabel="N"
    ];

    // Users -> Photo Sessions (1:N)
    users:pk -> photo_sessions:fk1 [
        label="initiates",
        headlabel="1",
        taillabel="N"
    ];

    // Templates -> Photo Sessions (1:N)
    templates:pk -> photo_sessions:fk2 [
        label="used_in",
        headlabel="1",
        taillabel="N"
    ];

    // Photo Sessions -> Captured Photos (1:N)
    photo_sessions:pk -> captured_photos:fk1 [
        label="contains",
        headlabel="1",
        taillabel="N"
    ];

    // Photo Sessions -> Final Composites (1:1)
    photo_sessions:pk -> final_composites:fk1 [
        label="produces",
        headlabel="1",
        taillabel="1"
    ];

    // Users -> Final Composites (1:N)
    users:pk -> final_composites:fk2 [
        label="owns",
        headlabel="1",
        taillabel="N"
    ];

    // Templates -> Final Composites (1:N)
    templates:pk -> final_composites:fk3 [
        label="applied_to",
        headlabel="1",
        taillabel="N"
    ];

    // Users -> User Galleries (1:N)
    users:pk -> user_galleries:fk1 [
        label="has",
        headlabel="1",
        taillabel="N"
    ];

    // Final Composites -> User Galleries (1:N)
    final_composites:pk -> user_galleries:fk2 [
        label="saved_in",
        headlabel="1",
        taillabel="N"
    ];

    // Users -> Analytics Events (1:N)
    users:pk -> analytics_events:fk1 [
        label="performs",
        headlabel="1",
        taillabel="N",
        style=dashed
    ];

    // Photo Sessions -> Analytics Events (1:N)
    photo_sessions:pk -> analytics_events:fk2 [
        label="tracked_by",
        headlabel="1",
        taillabel="N",
        style=dashed
    ];

    // Templates -> Analytics Events (1:N)
    templates:pk -> analytics_events:fk3 [
        label="monitored_by",
        headlabel="1",
        taillabel="N",
        style=dashed
    ];

    // Users -> System Settings (1:N) - Admin updates settings
    users:pk -> system_settings:fk1 [
        label="updates",
        headlabel="1",
        taillabel="N",
        style=dashed
    ];

    // ============================================
    // LEGEND
    // ============================================
    
    subgraph cluster_legend {
        label="LEGEND";
        fontcolor="white";
        fontsize=12;
        style=filled;
        fillcolor="#0f3460";
        color="#e94560";
        penwidth=2;

        legend [
            shape=note,
            fillcolor="#16213e",
            fontcolor="white",
            label="
                ERD - KaryaKlik Photo Booth\l
                \l
                • PK = Primary Key\l
                • FK = Foreign Key\l
                • Solid lines = Strong relationship\l
                • Dashed lines = Weak relationship\l
                \l
                Cardinality:\l
                • 1:N = One to Many\l
                • 1:1 = One to One\l
                \l
                Total Tables: 10\l
                Generated: 2025-11-11\l
            "
        ];
    }

    // ============================================
    // LAYOUT HINTS
    // ============================================
    
    // Group related tables
    {rank=same; users; categories;}
    {rank=same; templates; template_positions;}
    {rank=same; photo_sessions; captured_photos;}
    {rank=same; final_composites; user_galleries;}
    {rank=same; analytics_events; system_settings;}
}
