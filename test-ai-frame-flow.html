<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AI Frame Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .step {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .step h2 {
            color: #C62828;
            margin-bottom: 15px;
        }
        .step-number {
            display: inline-block;
            background: #C62828;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #E3F2FD;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
        }
        .success {
            background: #E8F5E9;
            border-left-color: #4CAF50;
        }
        .warning {
            background: #FFF3E0;
            border-left-color: #FF9800;
        }
        pre {
            background: #263238;
            color: #AAAAAA;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test AI Frame Flow - Debugging</h1>
    
    <div class="step">
        <h2><span class="step-number">1</span>Simulate AI Frame Generation</h2>
        <button onclick="simulateAIFrameGeneration()">Generate AI Frame & Store in SessionStorage</button>
        <div id="step1-result"></div>
    </div>

    <div class="step">
        <h2><span class="step-number">2</span>Check SessionStorage</h2>
        <button onclick="checkSessionStorage()">Check SessionStorage Data</button>
        <div id="step2-result"></div>
    </div>

    <div class="step">
        <h2><span class="step-number">3</span>Navigate to Booth (No Method)</h2>
        <p>This should redirect to Input Method Selection</p>
        <button onclick="navigateToBooth()">Open Booth with AI Frame</button>
        <div class="info">
            <strong>Expected:</strong> Will redirect to /input-method page
        </div>
    </div>

    <div class="step">
        <h2><span class="step-number">4</span>Navigate to Booth (With Method)</h2>
        <p>This should load the frame and start camera</p>
        <button onclick="navigateToBoothWithMethod('camera')">Open Booth with Camera</button>
        <button onclick="navigateToBoothWithMethod('upload')">Open Booth with Upload</button>
        <div class="info">
            <strong>Expected:</strong> Frame loaded and ready to take photos
        </div>
    </div>

    <div class="step">
        <h2><span class="step-number">5</span>Clear SessionStorage</h2>
        <button onclick="clearSessionStorage()">Clear All Data</button>
        <div id="step5-result"></div>
    </div>

    <script>
        function simulateAIFrameGeneration() {
            const frameSpec = {
                frameCount: 3,
                layout: 'vertical',
                backgroundColor: '#4A90E2',
                borderColor: '#2E5C8A',
                gradientFrom: '#4A90E2',
                gradientTo: '#2E5C8A'
            };

            // Simulate base64 image (SVG)
            const svgImage = `<svg width="600" height="900" xmlns="http://www.w3.org/2000/svg">
                <rect width="600" height="900" fill="${frameSpec.backgroundColor}"/>
                <text x="300" y="450" text-anchor="middle" fill="white" font-size="24">
                    AI Generated Frame
                </text>
            </svg>`;
            
            const base64Image = btoa(unescape(encodeURIComponent(svgImage)));
            const dataUrl = `data:image/svg+xml;base64,${base64Image}`;

            sessionStorage.setItem('aiFrameSpec', JSON.stringify(frameSpec));
            sessionStorage.setItem('aiFrameImage', dataUrl);

            document.getElementById('step1-result').innerHTML = `
                <div class="info success">
                    <strong>‚úÖ Success!</strong> AI Frame data stored in sessionStorage
                    <pre>${JSON.stringify(frameSpec, null, 2)}</pre>
                </div>
            `;
        }

        function checkSessionStorage() {
            const spec = sessionStorage.getItem('aiFrameSpec');
            const image = sessionStorage.getItem('aiFrameImage');

            let html = '<div class="info">';
            if (spec && image) {
                html += `
                    <strong>‚úÖ Data Found in SessionStorage</strong>
                    <p><strong>Frame Spec:</strong> ${spec.substring(0, 100)}...</p>
                    <p><strong>Image Data:</strong> ${image.substring(0, 100)}...</p>
                `;
            } else {
                html += `
                    <strong>‚ùå No Data in SessionStorage</strong>
                    <p>Please run Step 1 first</p>
                `;
            }
            html += '</div>';

            document.getElementById('step2-result').innerHTML = html;
        }

        function navigateToBooth() {
            const baseUrl = 'http://localhost:5173'; // Frontend URL
            const url = `${baseUrl}/booth?aiFrame=true`;
            
            window.open(url, '_blank');
        }

        function navigateToBoothWithMethod(method) {
            const baseUrl = 'http://localhost:5173';
            const templateId = 'ai-generated-' + Date.now();
            const url = `${baseUrl}/booth?template=${templateId}&method=${method}&aiFrame=true`;
            
            window.open(url, '_blank');
        }

        function clearSessionStorage() {
            sessionStorage.removeItem('aiFrameSpec');
            sessionStorage.removeItem('aiFrameImage');
            
            document.getElementById('step5-result').innerHTML = `
                <div class="info warning">
                    <strong>üóëÔ∏è SessionStorage Cleared</strong>
                </div>
            `;
        }

        // Auto-check on load
        window.onload = () => {
            checkSessionStorage();
        };
    </script>
</body>
</html>
